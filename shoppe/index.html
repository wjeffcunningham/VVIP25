<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VVIP Shoppe</title>
  <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <meta name="theme-color" content="#0b0b0c"/>
  <style>
    :root {
      --bg:#0b0b0c;
      --fg:#eceff4;
      --muted:#9aa0a6;
      --card:#141416;
      --border:#26272b;
      --accent:#fdf6d0;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font:16px/1.5 -apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,"Segoe UI",Roboto,Inter,system-ui,sans-serif;
    }

    #site-title{
      text-align:center;
      font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
      font-weight:700;
      font-size:56px;
      -webkit-text-stroke:2px var(--accent);
      letter-spacing:.06em;
      color:transparent;
      -webkit-text-fill-color:var(--fg);
      margin:40px 0 6px 0;
    }

    #back-link{
      display:block;
      text-align:center;
      color:var(--accent);
      font-weight:600;
      text-decoration:none;
      letter-spacing:.05em;
      margin-bottom:24px;
      transition:opacity .2s;
    }
    #back-link:hover{opacity:.7}

    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .grid{display:grid;gap:24px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
    .shop-item{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:0;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      transition:transform .2s ease;
    }
    .shop-item:hover{transform:scale(1.02)}
    .shop-item img{
      width:100%;
      aspect-ratio:1/1;
      object-fit:cover;
      border-radius:0;
    }
    .shop-item h3{margin:0;font-size:17px;line-height:1.3}
    .shop-item .desc{color:var(--muted);font-size:14px}
    .buy{display:flex;align-items:center;justify-content:space-between;margin-top:auto}
    .price{font-weight:bold;font-size:15px}
    .btn{
      display:inline-block;
      padding:6px 12px;
      border:1px solid var(--border);
      border-radius:8px;
      background:var(--bg);
      color:var(--fg);
      text-decoration:none;
      font-size:14px;
      transition:all .2s ease;
    }
    .btn:hover{border-color:var(--accent);color:var(--accent)}

    footer{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin:40px 0;
    }

    /* --- MINI PLAYER --- */
    #mini-player{
      position:fixed;
      bottom:0;left:0;right:0;
      background:var(--card);
      border-top:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding:10px 0;
    }
    #mini-player button{
      background:none;
      border:none;
      cursor:pointer;
      padding:4px;
      transition:transform .2s;
    }
    #mini-player button:hover{transform:scale(1.1)}
    #mini-player svg{
      width:28px;height:28px;
      fill:var(--accent);
    }
    #now-playing{
      color:var(--accent);
      font-weight:600;
      letter-spacing:.04em;
      font-size:15px;
    }

/* --- Collapsed / minimized state for sold-out items --- */
.shop-item.soldout {
  max-height: 72px;
  overflow: hidden;
  cursor: pointer;
  opacity: 0.55;
  transition: all 0.3s ease;
  position: relative;
}
.shop-item.soldout::after {
  content: "Sold Out — tap to expand";
  position: absolute;
  bottom: 8px;
  left: 0; right: 0;
  text-align: center;
  font-size: 13px;
  color: var(--muted);
}
.shop-item.soldout.open {
  max-height: 800px; /* expands to full */
  opacity: 1;
}
.shop-item.soldout.open::after {
  content: "";
}
</style>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const grid = document.getElementById('shop-grid');

  try {
    const res = await fetch('https://shoppe.vvipmedia.net/shoppe.json', { cache: 'no-store' });
    const txt = await res.text();

    let data;
    try {
      data = JSON.parse(txt);
      if (!Array.isArray(data)) throw new Error('shoppe.json is not an array');
      console.log(`✅ Loaded ${data.length} shop items`);
    } catch (err) {
      console.error('⚠️ Failed to parse JSON:', err, txt.slice(0, 200));
      grid.innerHTML = `<p>⚠️ Failed to load items.<br>${err.message}</p>`;
      return;
    }

    if (!data.length) {
      grid.innerHTML = `<p style="text-align:center;color:var(--muted)">No items found.</p>`;
      return;
    }

    grid.innerHTML = data.map(item => {
      const available = item.available !== false;
      const soldClass = available ? '' : 'soldout';
      const buttonHTML = available
        ? (item.bandcamp_url
            ? `<a href="${item.bandcamp_url}" class="btn" target="_blank" rel="noopener">View</a>`
            : item.fb_marketplace
              ? `<a href="${item.fb_marketplace}" class="btn" target="_blank" rel="noopener">View</a>`
              : `<span class="btn" style="opacity:.4;pointer-events:none">Unavailable</span>`)
        : `<span class="btn" style="opacity:.4;pointer-events:none">Sold&nbsp;Out</span>`;

      return `
        <div class="shop-item ${soldClass}">
          <img src="${item.image}" alt="${item.title}">
          <h3>${item.title}</h3>
          <p class="desc">${item.description}</p>
          <div class="buy">
            <span class="price">${item.currency || ''} ${item.price || ''}</span>
            ${buttonHTML}
          </div>
        </div>
      `;
    }).join('');

    document.querySelectorAll('.shop-item.soldout').forEach(card => {
      card.addEventListener('click', e => {
        if (e.target.closest('a,button')) return;
        card.classList.toggle('open');
      });
    });

  } catch (err) {
    console.error('⚠️ Shoppe load failed:', err);
    grid.innerHTML = `<p>⚠️ Failed to load items.<br>${err.message}</p>`;
  }

  // --- Mini-player restore ---
  try {
    const mini = document.getElementById('mini-player');
    const prevBtn = document.getElementById('prev');
    const playBtn = document.getElementById('playpause');
    const nextBtn = document.getElementById('next');
    const nowSpan = document.getElementById('now-playing');

    const svgPrev  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M7 5a1 1 0 0 1 1 1v12a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1zm11.4 1.2a1 1 0 0 1 .6.9v9.8a1 1 0 0 1-1.6.8l-8.2-4.9a1 1 0 0 1 0-1.7l8.2-4.9a1 1 0 0 1 1-.1z"/></svg>';
    const svgNext  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M17 5a1 1 0 0 1 1 1v12a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1zM5.6 6.2a1 1 0 0 1 1 .1l8.2 4.9a1 1 0 0 1 0 1.7l-8.2 4.9A1 1 0 0 1 5 17V7.2a1 1 0 0 1 .6-.9z"/></svg>';
    const svgPlay  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M8 5v14l11-7z"/></svg>';
    const svgPause = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>';

    prevBtn.innerHTML = svgPrev;
    nextBtn.innerHTML = svgNext;
    playBtn.innerHTML = svgPlay;

    const savedSrc   = localStorage.getItem('vvip25_src');
    const savedTime  = parseFloat(localStorage.getItem('vvip25_time')||0);
    const wasPlaying = localStorage.getItem('vvip25_playing')==='true';
    const savedTitle = localStorage.getItem('vvip25_title') || '—';
    if (!savedSrc) return;

    const audio = new Audio(savedSrc);
    audio.currentTime = savedTime;
    mini.style.display = 'flex';
    nowSpan.textContent = `Now Playing: ${savedTitle}`;

    playBtn.onclick = () => {
      if (audio.paused) {
        audio.play(); playBtn.innerHTML = svgPause;
        nowSpan.textContent = `Now Playing: ${savedTitle}`;
      } else {
        audio.pause(); playBtn.innerHTML = svgPlay;
        nowSpan.textContent = 'Paused';
      }
    };

    audio.addEventListener('ended', () => {
      audio.currentTime = 0;
      audio.play();
    });

    if (wasPlaying) audio.play().catch(()=>{});
  } catch (e) {
    console.warn('Mini-player restore failed', e);
  }
});
</script>

  <footer>© VVIP25 / VVIPMEDIA.NET</footer>
</body>
</html>