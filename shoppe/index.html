<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VVIP Shoppe</title>

<link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
<link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="preconnect" href="https://cdn.vvipmedia.net" crossorigin>
<link rel="preload" href="/player.html" as="fetch" crossorigin>
<meta name="theme-color" content="#0b0b0c"/>

<style>
:root {
  --bg:#0b0b0c;
  --fg:#eceff4;
  --muted:#9aa0a6;
  --card:#141416;
  --border:#26272b;
  --accent:#fdf6d0; /* gold */
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
  font:16px/1.5 -apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,"Segoe UI",Roboto,Inter,system-ui,sans-serif;
}

/* Header */
#site-title{
  text-align:center;
  font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
  font-weight:700;
  font-size:56px;
  -webkit-text-stroke:2px var(--accent);
  letter-spacing:.06em;
  color:transparent;
  -webkit-text-fill-color:var(--fg);
  margin:40px 0 6px 0;
}
#back-link{
  display:block;
  text-align:center;
  color:var(--accent);
  font-weight:600;
  text-decoration:none;
  letter-spacing:.05em;
  margin-bottom:24px;
  transition:opacity .2s;
}
#back-link:hover{opacity:.7}

.wrap{max-width:980px;margin:0 auto;padding:16px}

/* Grid */
.grid{
  display:grid;
  gap:24px;
  grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
}
.shop-item{
  background:var(--card);
  border:1px solid var(--border);
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:10px;
  transition:transform .2s ease, box-shadow .2s ease;
}
.shop-item:hover{transform:translateY(-1px)}
.shop-item img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border:1px solid var(--border);
}
.shop-item h3{margin:0;font-size:17px;line-height:1.3}
.shop-item .desc{color:var(--muted);font-size:14px}
.buy{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-top:auto
}
.price{font-weight:700;font-size:15px;letter-spacing:.02em}
.btn{
  display:inline-block;
  padding:6px 12px;
  border:1px solid var(--border);
  border-radius:8px;
  background:var(--bg);
  color:var(--fg);
  text-decoration:none;
  font-size:14px;
  transition:all .2s ease;
}
.btn:hover{border-color:var(--accent);color:var(--accent)}

/* Mini player */
#mini-player{
  position:fixed;
  bottom:0;left:0;right:0;
  background:var(--card);
  border-top:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:center;
  gap:18px;
  padding:10px 8px;
  z-index:10;
}
#mini-player button{
  background:none;border:none;cursor:pointer;
  padding:4px;transition:transform .15s;
}
#mini-player button:hover{transform:scale(1.08)}
#mini-player svg{width:26px;height:26px;fill:var(--accent)}
#now-playing{color:var(--accent);font-weight:600;letter-spacing:.04em;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:46vw}
#clock{color:var(--muted);font-size:14px}

/* Sold-out: minimized, not dreary; expandable */
.shop-item.soldout{
  max-height:72px;
  overflow:hidden;
  cursor:pointer;
  opacity:.8;                         /* not gloomy */
  filter:saturate(.9) contrast(.95);  /* subtle */
  position:relative;
  transition:all .25s ease;
}
.shop-item.soldout::after{
  content:"Sold Out — tap to expand";
  position:absolute;bottom:8px;left:0;right:0;
  text-align:center;font-size:13px;color:var(--muted)
}
.shop-item.soldout.open{
  max-height:800px;
  opacity:1;
  filter:none;
}
.shop-item.soldout.open::after{content:""}

/* Footer spacer (so grid not hidden behind mini-player) */
footer{height:72px}
.credits{text-align:center;color:var(--muted);font-size:13px;margin:28px 0}
</style>
</head>

<body>
<!-- persistent iframe player (hidden) -->
<iframe id="vvip-player-frame" src="https://shoppe.vvipmedia.net/player.html" allow="autoplay" style="display:none;width:0;height:0;border:0"></iframe>

<main id="page-root" data-page="shoppe" class="wrap">
  <h1 id="site-title">VVIP SHOPPE</h1>
  <a href="https://vvipmedia.net" id="back-link">← Back to VVIP25</a>

  <section class="grid" id="shop-grid" aria-live="polite"></section>

  <div class="credits">© VVIP25 / VVIPMEDIA.NET</div>
</main>

<!-- Mini player -->
<div id="mini-player" role="region" aria-label="Mini player">
  <button id="prev" aria-label="Previous track" title="Previous">
    <!-- Prev: |◀ -->
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M6 5h2v14H6zM20 19L9 12l11-7v14z"/></svg>
  </button>
  <button id="playpause" aria-label="Play/Pause" title="Play/Pause">
    <!-- Play default -->
    <svg id="pp-icn" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M8 5v14l11-7z"/></svg>
  </button>
  <button id="next" aria-label="Next track" title="Next">
    <!-- Next: ▶| -->
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M16 5h2v14h-2zM4 19l11-7L4 5v14z"/></svg>
  </button>

  <span id="now-playing">Nothing playing</span>
  <span id="clock" style="margin-left:8px;">0:00</span>
</div>

<script>
/* ---------- Player messaging ---------- */
const playerFrame = document.getElementById("vvip-player-frame");
function sendToPlayer(msg){ playerFrame?.contentWindow?.postMessage(msg, "*"); }

/* ---------- Load Shop items ---------- */
document.addEventListener("DOMContentLoaded", async () => {
  const grid = document.getElementById("shop-grid");
  try {
    const res = await fetch("https://shoppe.vvipmedia.net/shoppe.json", { cache: "no-store" });
    const items = await res.json();

    grid.innerHTML = items.map(item => {
      const sold = item.available === false;
      const priceStr = (item.currency ? item.currency + " " : "") + (item.price ?? "");
      const btn = item.bandcamp_url
        ? `<a href="${item.bandcamp_url}" class="btn" target="_blank" rel="noopener noreferrer">View</a>`
        : `<span class="btn" style="opacity:.5;pointer-events:none">${sold ? "Sold Out" : "Unavailable"}</span>`;
      return `
        <article class="shop-item ${sold ? "soldout" : ""}" ${sold ? 'title="Sold Out — tap to expand"' : ""}>
          <img src="${item.image}" alt="${item.title}" loading="lazy" decoding="async">
          <h3>${item.title}</h3>
          <p class="desc">${item.description || ""}</p>
          <div class="buy">
            <span class="price">${priceStr}</span>
            ${btn}
          </div>
        </article>
      `;
    }).join("");

  } catch (err) {
    console.error("Shoppe load failed:", err);
    grid.innerHTML = `<p>⚠️ Failed to load items.</p>`;
  }
});

/* ---------- Sold-out expand/collapse ---------- */
document.addEventListener("click", (e) => {
  const card = e.target.closest(".shop-item.soldout");
  if (card) card.classList.toggle("open");
});

/* ---------- Mini player controls ---------- */
const playBtn = document.getElementById("playpause");
const ppIcn   = document.getElementById("pp-icn");
const prevBtn = document.getElementById("prev");
const nextBtn = document.getElementById("next");
const nowSpan = document.getElementById("now-playing");
const clockEl = document.getElementById("clock");

const ICN_PLAY  = '<path d="M8 5v14l11-7z"/>';
const ICN_PAUSE = '<path d="M6 5h4v14H6zM14 5h4v14h-4z"/>';

/* Restore last known track quickly so UI isn't blank */
const savedSrc   = localStorage.getItem("vvip25_src");
const savedTitle = localStorage.getItem("vvip25_title") || "";
const savedTime  = parseFloat(localStorage.getItem("vvip25_time") || 0);
const wasPlaying = localStorage.getItem("vvip25_playing") === "true";

if (savedSrc) {
  nowSpan.textContent = "Now Playing: " + (savedTitle || "—");
  sendToPlayer({ cmd: "load", src: savedSrc, time: savedTime, play: wasPlaying });
  if (wasPlaying) ppIcn.innerHTML = ICN_PAUSE;
}

/* Button handlers */
playBtn.addEventListener("click", () => {
  const isPlaying = playBtn.dataset.playing === "true";
  if (isPlaying) {
    sendToPlayer({ cmd: "pause" });
    ppIcn.innerHTML = ICN_PLAY;
    playBtn.dataset.playing = "false";
  } else {
    sendToPlayer({ cmd: "play" });
    ppIcn.innerHTML = ICN_PAUSE;
    playBtn.dataset.playing = "true";
  }
});
prevBtn.addEventListener("click", () => sendToPlayer({ cmd: "prev" }));
nextBtn.addEventListener("click", () => sendToPlayer({ cmd: "next" }));

/* One unified status listener keeps UI synced and label fresh */
window.addEventListener("message", (e) => {
  const d = e.data;
  if (!d || typeof d !== "object") return;

  if (d.status === "update") {
    // play/pause icon + data-flag
    const playing = !!d.playing;
    ppIcn.innerHTML = playing ? ICN_PAUSE : ICN_PLAY;
    playBtn.dataset.playing = String(playing);

    // clock
    if (typeof d.time === "number") {
      clockEl.textContent = fmtTime(d.time);
    }

    // update "Now Playing" if title present in storage
    const t = localStorage.getItem("vvip25_title");
    if (t) nowSpan.textContent = "Now Playing: " + t;
  }
});

/* Helpers */
function fmtTime(sec){
  const m = Math.floor(sec / 60);
  const s = Math.floor(sec % 60);
  return `${m}:${s.toString().padStart(2,"0")}`;
}
</script>

<footer></footer>
</body>
</html>