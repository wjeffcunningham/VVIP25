<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VVIP Shoppe</title>
  <link rel="icon" type="image/png" sizes="64x64" href="/favicon-64.png">
  <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <meta name="theme-color" content="#0b0b0c"/>
  <style>
    :root {
      --bg:#0b0b0c;
      --fg:#eceff4;
      --muted:#9aa0a6;
      --card:#141416;
      --border:#26272b;
      --accent:#fdf6d0; /* gold same as main */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font:16px/1.5 -apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,"Segoe UI",Roboto,Inter,system-ui,sans-serif;
    }

    #site-title{
      text-align:center;
      font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
      font-weight:700;
      font-size:56px;
      -webkit-text-stroke:2px var(--accent);
      letter-spacing:.06em;
      color:transparent;
      -webkit-text-fill-color:var(--fg);
      margin:40px 0 6px 0;
    }

    #back-link{
      display:block;
      text-align:center;
      color:var(--accent);
      font-weight:600;
      text-decoration:none;
      letter-spacing:.05em;
      margin-bottom:24px;
      transition:opacity .2s;
    }
    #back-link:hover{opacity:.7}

    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .grid{display:grid;gap:24px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
    .shop-item{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:0; /* square now */
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
      transition:transform .2s ease;
    }
    .shop-item:hover{transform:scale(1.02)}
    .shop-item img{
      width:100%;
      aspect-ratio:1/1;
      object-fit:cover;
      border-radius:0; /* square images */
    }
    .shop-item h3{margin:0;font-size:17px;line-height:1.3}
    .shop-item .desc{color:var(--muted);font-size:14px}
    .buy{display:flex;align-items:center;justify-content:space-between;margin-top:auto}
    .price{font-weight:bold;font-size:15px}
    .btn{
      display:inline-block;
      padding:6px 12px;
      border:1px solid var(--border);
      border-radius:8px;
      background:var(--bg);
      color:var(--fg);
      text-decoration:none;
      font-size:14px;
      transition:all .2s ease;
    }
    .btn:hover{border-color:var(--accent);color:var(--accent)}

    footer{
      text-align:center;
      color:var(--muted);
      font-size:13px;
      margin:40px 0;
    }

    /* --- MINI PLAYER --- */
    #mini-player{
      position:fixed;
      bottom:0;left:0;right:0;
      background:var(--card);
      border-top:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      padding:10px 0;
    }
    #mini-player button{
      background:none;
      border:none;
      cursor:pointer;
      padding:4px;
      transition:transform .2s;
    }
    #mini-player button:hover{transform:scale(1.1)}
    #mini-player svg{
      width:28px;height:28px;
      fill:var(--accent);
    }
    #now-playing{
      color:var(--accent);
      font-weight:600;
      letter-spacing:.04em;
      font-size:15px;
    }
  </style>
</head>
<body>
  <main id="page-root" data-page="shoppe">
    <div class="wrap">
      <h1 id="site-title">VVIP SHOPPE</h1>
      <a href="https://vvipmedia.net" id="back-link">← Back to VVIP25</a>
      <section class="grid" id="shop-grid"></section>
    </div>
  </main>

  <div id="mini-player" style="display:none">
    <button id="prev" aria-label="Previous">
      <svg viewBox="0 0 24 24"><path d="M7 12l10-8v16z"/></svg>
    </button>
    <button id="playpause" aria-label="Play/Pause">
      <svg id="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    </button>
    <button id="next" aria-label="Next">
      <svg viewBox="0 0 24 24"><path d="M17 12l-10 8V4z"/></svg>
    </button>
    <span id="now-playing">Nothing playing</span>
  </div>

  <script>
  // Load shop items
  async function loadShoppe(){
    const grid=document.getElementById('shop-grid');
    try{
      const res=await fetch('./shoppe.json',{cache:'no-store'});
      if(!res.ok) throw new Error(`shoppe.json ${res.status}`);
      const data=await res.json();
      if(!Array.isArray(data)) throw new Error('Invalid shoppe.json format');
      data.forEach(item=>{
        const card=document.createElement('div');
        card.className='shop-item';
        card.innerHTML=`
          <img src="${item.image}" alt="${item.title}">
          <h3>${item.title}</h3>
          <p class="desc">${item.description}</p>
          <div class="buy">
            <span class="price">${item.currency||''} ${item.price||''}</span>
            ${
              item.bandcamp_url
                ? `<a href="${item.bandcamp_url}" class="btn" target="_blank" rel="noopener">View</a>`
                : `<span class="btn" style="opacity:.4;pointer-events:none">Sold&nbsp;Out</span>`
            }
          </div>`;
        grid.appendChild(card);
      });
    }catch(e){
      console.error('⚠️ Shoppe load failed:',e);
      grid.innerHTML='<p>⚠️ Failed to load items.</p>';
    }
  }
  loadShoppe();

  // --- Restore music state from main page, using titles.json ---
  (async () => {
    try {
      const savedSrc = localStorage.getItem('vvip25_src');
      const savedTime = parseFloat(localStorage.getItem('vvip25_time')||0);
      const wasPlaying = localStorage.getItem('vvip25_playing')==='true';
      if(!savedSrc) return;

      // load titles.json for proper name mapping
      const titleMap = await fetch('https://vvipmedia.net/titles.json').then(r=>r.json()).catch(()=>{});
      let trackName;
      if(titleMap && savedSrc){
        const filename = savedSrc.split('/').pop().split('?')[0];
        trackName = titleMap[filename] || decodeURIComponent(filename.replace(/\.[a-z0-9]+$/i,'').replace(/[_-]+/g,' '));
      } else {
        const srcFile = savedSrc.split('/').pop().split('?')[0];
        trackName = decodeURIComponent(srcFile.replace(/\.[a-z0-9]+$/i,'').replace(/[_-]+/g,' '));
      }

      const audio = new Audio(savedSrc);
      audio.currentTime = savedTime;

      const mini = document.getElementById('mini-player');
      const playBtn = document.getElementById('playpause');
      const playIcon = document.getElementById('play-icon');
      const nowSpan = document.getElementById('now-playing');
      mini.style.display='flex';

      nowSpan.textContent = `Now Playing: ${trackName}`;
      if (wasPlaying) await audio.play().catch(()=>{});

      playBtn.onclick = () => {
        if (audio.paused){
          audio.play();
          playIcon.innerHTML='<path d="M6 5h4v14H6zm8 0h4v14h-4z"/>'; // pause
          nowSpan.textContent=`Playing: ${trackName}`;
        } else {
          audio.pause();
          playIcon.innerHTML='<path d="M8 5v14l11-7z"/>'; // play
          nowSpan.textContent='Paused';
        }
      };
    }catch(e){console.warn('Player restore failed:', e);}
  })();
  </script>

  <footer>© VVIP25 / VVIPMEDIA.NET</footer>
  <!-- === MINI PLAYER (VVIP-style) === -->
<div id="mini-player" style="display:none">
  <button id="prev" aria-label="Previous"></button>
  <button id="playpause" aria-label="Play/Pause"></button>
  <button id="next" aria-label="Next"></button>
  <span id="now-playing">Nothing playing</span>
</div>

<script>
/* ----------------- Mini Player Sync ------------------ */
(async () => {
  const mini = document.getElementById('mini-player');
  const prevBtn = document.getElementById('prev');
  const playBtn = document.getElementById('playpause');
  const nextBtn = document.getElementById('next');
  const nowSpan = document.getElementById('now-playing');

  // --- bespoke SVGs (identical to main site) ---
  const svgPrev  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M7 5a1 1 0 0 1 1 1v12a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1zm11.4 1.2a1 1 0 0 1 .6.9v9.8a1 1 0 0 1-1.6.8l-8.2-4.9a1 1 0 0 1 0-1.7l8.2-4.9a1 1 0 0 1 1-.1z"/></svg>';
  const svgNext  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M17 5a1 1 0 0 1 1 1v12a1 1 0 1 1-2 0V6a1 1 0 0 1 1-1zM5.6 6.2a1 1 0 0 1 1 .1l8.2 4.9a1 1 0 0 1 0 1.7l-8.2 4.9A1 1 0 0 1 5 17V7.2a1 1 0 0 1 .6-.9z"/></svg>';
  const svgPlay  = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M8 5v14l11-7z"/></svg>';
  const svgPause = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="#fdf6d0" d="M6 5h4v14H6zM14 5h4v14h-4z"/></svg>';

  prevBtn.innerHTML = svgPrev;
  nextBtn.innerHTML = svgNext;
  playBtn.innerHTML = svgPlay;

  // --- load main-page state + manifests ---
  const savedSrc   = localStorage.getItem('vvip25_src');
  const savedTime  = parseFloat(localStorage.getItem('vvip25_time')||0);
  const wasPlaying = localStorage.getItem('vvip25_playing')==='true';
  if (!savedSrc) return;

  // load manifest (for ordering)
  let manifest = [];
  try {
    const m = await fetch('https://vvipmedia.net/manifest.json', { cache: 'no-store' });
    manifest = await m.json();
  } catch {}

  // load titles
  let titles = {};
  try {
    titles = await fetch('https://vvipmedia.net/titles.json').then(r=>r.json());
  } catch {}

  // create audio
  const audio = new Audio(savedSrc);
  audio.currentTime = savedTime;

  // find current index within manifest
  const files = manifest.map(t => t.name);
  let idx = files.findIndex(f => savedSrc.includes(f));
  if (idx < 0) idx = 0;

  function getTitle(i){
    const file = files[i] || '';
    return titles[file] ||
      decodeURIComponent(file.replace(/\.[a-z0-9]+$/i,'').replace(/[_-]+/g,' '));
  }

  // --- UI update ---
  function updateNow(label){
    nowSpan.textContent = `Now Playing: ${label}`;
  }

  mini.style.display = 'flex';
  updateNow(getTitle(idx));

  if (wasPlaying) {
    try { await audio.play(); playBtn.innerHTML = svgPause; } catch{}
  }

  playBtn.onclick = () => {
    if (audio.paused) {
      audio.play(); playBtn.innerHTML = svgPause;
      updateNow(getTitle(idx));
    } else {
      audio.pause(); playBtn.innerHTML = svgPlay;
      nowSpan.textContent = 'Paused';
    }
  };

  prevBtn.onclick = () => {
    if (!files.length) return;
    idx = (idx - 1 + files.length) % files.length;
    audio.src = 'https://cdn.vvipmedia.net/ACCESS/' + encodeURIComponent(files[idx]);
    updateNow(getTitle(idx));
    audio.play(); playBtn.innerHTML = svgPause;
  };

  nextBtn.onclick = () => {
    if (!files.length) return;
    idx = (idx + 1) % files.length;
    audio.src = 'https://cdn.vvipmedia.net/ACCESS/' + encodeURIComponent(files[idx]);
    updateNow(getTitle(idx));
    audio.play(); playBtn.innerHTML = svgPause;
  };
})();
</script>
</body>
</html>